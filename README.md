# ğŸ¤– Azure OpenAI PR Review Agent

An intelligent, automated Pull Request review system powered by Azure OpenAI and built with clean architecture principles.

## ğŸ¯ What This Project Does

This GitHub Action automatically reviews Pull Requests using Azure OpenAI's GPT models, providing intelligent feedback on:
- **Code Quality**: Best practices, naming conventions, structure
- **Security Issues**: Potential vulnerabilities and security concerns  
- **Performance**: Optimization opportunities and bottlenecks
- **Maintainability**: Code clarity, documentation, and technical debt

## ğŸ”„ How It Works - Complete Flow

```mermaid
flowchart TB
    subgraph "ğŸ™ GitHub Events"
        PR[ğŸ“ Pull Request<br/>opened/updated]
    end
    
    subgraph "âš™ï¸ GitHub Actions"
        WORKFLOW[ğŸ¯ Workflow Trigger<br/>.github/workflows/pr-review.yml]
        CHECKOUT[ğŸ“¥ Checkout Code]
        ACTION[ğŸ­ Custom Action<br/>./action.yml]
    end
    
    subgraph "ğŸ³ Docker Container"
        BUILD[ğŸ”¨ Build from Dockerfile]
        ENV[ğŸŒ Environment Variables<br/>Azure credentials]
        PYTHON[ğŸ Python Application<br/>src/main.py]
    end
    
    subgraph "ğŸ§  AI Analysis"
        AZURE[â˜ï¸ Azure OpenAI<br/>GPT-4 Analysis]
        STRUCTURED[ğŸ“Š Structured Response<br/>JSON format]
    end
    
    subgraph "ğŸ“¤ Results"
        COMMENT[ğŸ’¬ PR Comment<br/>Formatted feedback]
        OUTPUTS[ğŸ“‹ Action Outputs<br/>For workflow use]
    end
    
    PR --> WORKFLOW
    WORKFLOW --> CHECKOUT
    CHECKOUT --> ACTION
    ACTION --> BUILD
    BUILD --> ENV
    ENV --> PYTHON
    PYTHON --> AZURE
    AZURE --> STRUCTURED
    STRUCTURED --> COMMENT
    STRUCTURED --> OUTPUTS
    
    style PR fill:#e1f5fe
    style AZURE fill:#fff3e0
    style COMMENT fill:#e8f5e8
```

## ğŸ—ï¸ Project Architecture

This project demonstrates **SOLID principles** and **clean architecture**:

```
src/
â”œâ”€â”€ main.py                    # ğŸš€ Entry point & orchestrator
â”œâ”€â”€ interfaces/                # ğŸ­ Abstract contracts (Dependency Inversion)
â”‚   â””â”€â”€ ai_provider.py
â”œâ”€â”€ models/                    # ğŸ“Š Immutable data structures
â”‚   â”œâ”€â”€ pr_data.py            #     â€¢ Pull request information
â”‚   â””â”€â”€ review_result.py      #     â€¢ AI analysis results
â”œâ”€â”€ providers/                 # ğŸ§  AI service implementations
â”‚   â””â”€â”€ azure_openai_provider.py
â”œâ”€â”€ services/                  # ğŸ”§ Business logic orchestration
â”‚   â””â”€â”€ pr_review_service.py
â””â”€â”€ utils/                     # ğŸ› ï¸ Shared utilities
    â””â”€â”€ logger.py
```

### ğŸ¨ SOLID Principles Applied

- **ğŸ¯ Single Responsibility**: Each class has one clear purpose
- **ğŸ”“ Open/Closed**: New AI providers can be added without modifying existing code
- **ğŸ”„ Liskov Substitution**: Any `AIProvider` implementation can replace `AzureOpenAIProvider`
- **ğŸ­ Interface Segregation**: Clean, focused interfaces
- **ğŸ”— Dependency Inversion**: High-level modules depend on abstractions

## ğŸš€ Quick Setup

### 1. **Configure Repository Secrets**

Add these secrets in your GitHub repository settings:

```bash
AZURE_OPENAI_ENDPOINT         # https://your-resource.openai.azure.com/
AZURE_OPENAI_API_KEY          # Your Azure OpenAI API key
AZURE_OPENAI_DEPLOYMENT_NAME  # Model deployment name (e.g., "gpt-4")
```

### 2. **Add Workflow File**

The workflow is already included at `.github/workflows/pr-review.yml` and will automatically:
- âœ… Trigger on PR events (opened, updated, reopened)
- âœ… Run AI analysis in a secure Docker container
- âœ… Post formatted review comments
- âœ… Handle errors gracefully with fallback comments

### 3. **Test the System**

1. Create a test pull request
2. Watch the workflow run in the "Actions" tab
3. See the AI review comment appear on your PR

## ï¿½ Sample AI Review Output

The system generates comprehensive, formatted reviews:

```markdown
## ğŸ¤– AI Code Review

**Overall Score:** 7/10
**Status:** âœ… Approved

### Summary
The code changes show good structure and error handling improvements. 
Consider adding input validation and optimizing the nested loops.

### Comments

âŒ **src/sample.py:15**
  Missing input validation could lead to security vulnerabilities

âš ï¸ **src/sample.py:28** 
  Nested loops create O(nÂ²) complexity - consider using a set for lookups

â„¹ï¸ **README.md**
  Documentation updates improve project clarity

---
*Generated by Azure OpenAI PR Review Agent*
```

## âš™ï¸ Configuration Options

Customize the AI behavior through action inputs:

```yaml
- name: Azure OpenAI PR Review
  uses: ./
  with:
    azure_openai_endpoint: ${{ secrets.AZURE_OPENAI_ENDPOINT }}
    azure_openai_api_key: ${{ secrets.AZURE_OPENAI_API_KEY }}
    azure_openai_deployment_name: ${{ secrets.AZURE_OPENAI_DEPLOYMENT_NAME }}
    max_tokens: '2000'      # Longer responses
    temperature: '0.2'      # Slightly more creative
```

## ğŸ§ª Local Development & Testing

### Run Structure Validation
```bash
python validate_project.py
```

### Test with Docker (Local)
```bash
# Set environment variables
export AZURE_OPENAI_ENDPOINT="your-endpoint"
export AZURE_OPENAI_API_KEY="your-key"
export AZURE_OPENAI_DEPLOYMENT_NAME="gpt-4"

# Build and run
./test_local.sh
```

### Run Tests
```bash
python test_structure.py
python test_fixes.py
```

## ğŸ”§ Technical Deep Dive

### Key Components Explained

#### 1. **GitHub Actions Integration**
- **Trigger**: Responds to `pull_request` events
- **Permissions**: Minimal required permissions for security
- **Secrets**: Secure credential handling via repository secrets

#### 2. **Docker Containerization**  
- **Isolation**: Consistent execution environment
- **Security**: Minimal attack surface with slim Python image
- **Efficiency**: Layer caching for faster builds

#### 3. **Azure OpenAI Integration**
- **Retry Logic**: Exponential backoff for API resilience
- **Error Handling**: Graceful degradation with fallback responses
- **Structured Output**: JSON parsing for consistent results

#### 4. **Clean Architecture**
- **Dependency Injection**: Testable, flexible design
- **Immutable Models**: Thread-safe data structures
- **Interface-Based**: Easy to extend with new AI providers

## ğŸ”’ Security Features

- âœ… **Credential Security**: Secrets never exposed in logs
- âœ… **Minimal Permissions**: Least privilege access model  
- âœ… **Container Isolation**: Secure execution environment
- âœ… **Input Validation**: PR data sanitization
- âœ… **Error Boundaries**: Secure error handling

## ğŸ¯ Use Cases

### For Individual Developers
- Get instant feedback on code quality
- Learn best practices through AI recommendations
- Catch potential issues before peer review

### For Development Teams  
- Standardize code review processes
- Reduce manual review overhead
- Maintain consistent code quality standards

### For Open Source Projects
- Scale code review for community contributions
- Provide immediate feedback to contributors
- Maintain project quality at scale

## ğŸš€ Future Extensions

The architecture supports easy extension:

- ğŸ”„ **Multiple AI Providers** (OpenAI, Anthropic, etc.)
- ğŸ¨ **Custom Review Templates** (Security-focused, Performance-focused)
- ğŸ“Š **Code Quality Metrics** (SonarQube, CodeClimate integration)
- ğŸ” **Security Scanning** (Bandit, Safety integration)
- ğŸ“ˆ **Performance Analysis** (Profiling, benchmarking)

## ğŸ“š Documentation

- [`ARCHITECTURE.md`](ARCHITECTURE.md) - Detailed system architecture and flow diagrams
- [`FIXES.md`](FIXES.md) - GitHub Actions issues resolved  
- [`docs/future-features.md`](docs/future-features.md) - Planned extensions

## ğŸ¤ Contributing

This project follows clean architecture principles. When contributing:

1. **Follow SOLID Principles**: Single responsibility, dependency inversion
2. **Add Tests**: Unit tests for new functionality
3. **Update Documentation**: Keep README and architecture docs current
4. **Security First**: Validate inputs, handle secrets securely

## ğŸ“„ License

This project is open source. Feel free to use, modify, and distribute according to your needs.

---

**Built with â¤ï¸ using Azure OpenAI, GitHub Actions, and Clean Architecture principles**
